@using System.Globalization
@{
    ViewData["Title"] = "Geçmiş Etkinlikler";
    var tr = CultureInfo.GetCultureInfo("tr-TR");
    object? Prop(object? o, string n) { var p = o?.GetType().GetProperty(n); return p?.GetValue(o); }
    IEnumerable<object> AsList(object? o)
    {
        if (o is null) return Enumerable.Empty<object>();
        if (o is IEnumerable<object> ie) return ie;
        if (o is System.Collections.IEnumerable ien && o is not string) return ien.Cast<object>();
        foreach (var k in new[] { "Items", "Events", "List", "Results", "Data" })
        {
            var v = Prop(o, k);
            if (v is IEnumerable<object> ie2) return ie2;
            if (v is System.Collections.IEnumerable ien2 && v is not string) return ien2.Cast<object>();
        }
        return Enumerable.Empty<object>();
    }
    var items = AsList(Model).ToList();
    var pager = Prop(Model, "Pager") ?? Prop(Model, "Pagination");
}
<div class="container-xxl px-3 px-lg-4 events-page">
    <div class="evt-head"><div class="title">Geçmiş Etkinlikler</div><div class="sub">@DateTime.Today.ToString("yyyy")</div></div>

    <div class="evt-list">
        @foreach (var e in items)
        {
            string title = (Prop(e, "Title") ?? Prop(e, "Name"))?.ToString() ?? "Etkinlik";
            string? slug = (Prop(e, "Slug") ?? Prop(e, "Id"))?.ToString();
            string? img = (Prop(e, "HeroImagePath") ?? Prop(e, "ImageUrl"))?.ToString();
            string? venue = (Prop(e, "VenueName") ?? Prop(e, "Venue"))?.ToString();
            var start = (Prop(e, "StartLocal") as DateTime?) ?? DateTime.MinValue;

            var imgUrl = string.IsNullOrWhiteSpace(img) ? Url.Content("~/img/placeholders/event-wide.jpg")
            : (img!.StartsWith("/") ? Url.Content(img) : img);
            <article class="evt-item shadow-sm">
                <div class="thumb"><img src="@imgUrl" alt="@title" /></div>
                <div class="content">
                    <h3 class="evt-title"><a class="stretched-link text-decoration-none" asp-controller="Events" asp-action="Details" asp-route-slug="@slug">@title</a></h3>
                    @if (!string.IsNullOrWhiteSpace(venue))
                    {
                        <div class="evt-venue"><i class="bi bi-geo-alt"></i> @venue</div>
                    }
                </div>
                <div class="meta">
                    <div class="meta-col"><div class="label">Tarih</div><div class="value">@start.ToString("dd.MM.yyyy", tr)</div></div>
                    <div class="meta-col"><div class="label">Saat</div><div class="value">@start.ToString("HH:mm", tr)</div></div>
                    <div class="more"><a asp-controller="Events" asp-action="Details" asp-route-slug="@slug" class="link-more">Detaylar <i class="bi bi-chevron-right"></i></a></div>
                </div>
            </article>
        }
    </div>

    @if (pager is not null)
    {
        <div class="mt-3">@await Html.PartialAsync("_PublicPager", (object)pager)</div>
    }
</div>
